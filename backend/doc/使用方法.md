# `Brain Overflow Server` 的启动方式
## 配置文件

示例：

```toml
[server]
port = 10086
ipv4_enabled = false
ipv6_enabled = true
log_level = "info"
secret_key = "SGVsbG8gd29ybGQ=" # 此处是 "Hello world" 的 Base64 编码后的字符串

[database]
host = "localhost"
port = 5432
user = "postgres"
password = "123456"
database = "br_ovfl"
max_connection = 80
min_connection = 4
```

配置文件由两个块组成，`server` 块和 `database` 块

### `server` 块

|      字段名       |  字段值类型   |                   接受的值                    |          效果           |            备注            |
| :------------: | :------: | :---------------------------------------: | :-------------------: | :----------------------: |
|     `port`     |  `int`   |                                           |  设定此**服务器实例**监听的端口号   |                          |
| `ipv4_enabled` |  `bool`  |                                           |     启用 `IPv4` 支持      |       与 `IPv6` 互补        |
| `ipv6_enabled` |  `bool`  |                                           |     启用 `ipv6` 支持      |       与 `IPv4` 互补        |
|  `log_level`   | `string` | `trace`, `debug`, `info`, `warn`, `error` |     设定服务器输出日志的等级      |                          |
|  `secret_key`  | `string` |                                           | 设定服务器的  **JWT** 的签名密钥 | 此值必须为一个使用 Base 64 编码的字符串 |
### `database` 块

|       字段名        |  字段值类型   | 接受的值 |              效果               | 备注  |
| :--------------: | :------: | :--: | :---------------------------: | :-: |
|      `host`      | `string` |      |          设定数据库所在的主机           |     |
|      `port`      |  `int`   |      |        该**数据库监听**的端口号         |     |
|      `user`      | `string` |      |    **服务器实例将**以什么用户身份连接数据库     |     |
|    `password`    | `string` |      | 数据库中设置的 `user` 对应的 `password` |     |
|    `database`    | `string` |      |       此服务器实例将连接到哪一个数据库        |     |
| `max_connection` |  `int`   |      |        服务器连接时，连接池的最大个数        |     |
| `min_connection` |  `int`   |      |        服务器连接时，连接池的最大个数        |     |

## 命令行启动

通过运行以下命令获取提示

```shell
br-ovfl-svr.exe -h
```

应该得到以下的输出：

```shell
The server of project Brain Overflow

Usage: br-ovfl-svr.exe [OPTIONS]


Options:
  -p, --port <PORT>  Port of server, will override the port specified in config file
  -h, --help         Print help
  -V, --version      Print version
```

### `--port` 参数

指定**服务器实例监听的**端口号，此参数将**覆盖**配置文件指定的端口号

## `cargo run` 启动服务器

`cargo run` 将进行**编译**，**编译完成后**启动生成的可执行文件。

cargo 总体遵循这样的语法：

```shell
cargo [BUILD_FALGS] -- [PARAMS]
```

在 `--` 之前的为传递给 **cargo 构建系统** 的参数，而 `--` 之后的为传递给**此次生成的*** *可执行文件* 的参数
### 指定 feature

通过 `--feature` (别名：`-F`)，可以指定 `feature`。例如：通过 `cargo run --feature more-message` 将在**编译时启用**服务器的更多返回信息的功能，然后启动相应的服务器。即： `cargo run --feature more-message` 和  `cargo run --feature less-message` **生成的二进制代码是不一样的**

### 给服务器传递参数

以上是给 cargo 构建器传递参数的情况，给生成的服务器传递参数的示例为：

```shell
cargo run --features less-message -- -p 80
```

这条命令意味着，启用 `less-message` 功能编译服务器实例，并使服务器监听 80 端口的请求。

## features

[[使用方法#指定 feature|上文]]中谈论了**编译时**启用 feature，现在来看看具体有那些 `feature`
### more-message

在启用了此功能后，服务器在[[doc/API#服务器校验或者参数不正确|服务器校验失败或者参数错误]]时返回的内容将更加详尽和人类可读

```json
[
    {"code":"jsonDataError","msg":"data error"},
    {"code":"jsonSyntaxError","msg":"data error"},
    {"code":"pathFormatError","msg":"data error"},
    {"code":"pathMissingFields","msg":"data error"},
    {"code":"queryParamDeserializeFailed","msg":"data error"},
    {"code":"contentTypeMissing","msg":"data error"},
    {"code":"failedBufferBody","msg":"data error"},
    {"code":"invalidParam","msg":"data error"},
]
```

msg 中将返回为具体的错误内容