# 用户认证模块
## 注册功能
-  URI：`/usr`
- 功能：创建一个用户
- 是否受到保护：否
- 请求方法：POST
- 接受参数：json 对象
- 请求体的 mime-type: `application/json`
```json
{
	"name": "string",     // 必须
	"email": "string",    // 非必须
	"phone": "string",    // 非必须，但和上面的必须二选一
	"passwd": "string",   // 必须
}
```

> [!info]
> `email` 和 `phone` 字段二选一
> 
> 前端传过来之前最好验证一下是否符合邮件和电话号码格式（电话号码格式采用 E164 格式，就是由国家前缀，如中国 +86 那种，并且中间没有空格）

> [!info]
> ### 验证密码复杂度
> 三种字符，字母、数字、特殊字符，服务器将统计密码中的字母数、数字数、特殊字符数
> 每种字符如果总数大于2，将被统计进字符种类数，如密码 "01234567891a" 就只算**一种字符**，因为只有**一个字母 'a'**
> 这三种字符中必须有**两种以上**，如不满足，则**无法通过校验**
> 密码长度小于 12 个**字符**的，**无法通过校验**

- 返回内容：

|  条件  | 响应码 |                    表头内容                     |  报文内容   |
| :--: | :-: | :-----------------------------------------: | :-----: |
| 成功注册 | 201 | `Location: /usr/info/${id}`, 这个路径可以获取用户详细信息 | jwt 字符串 |


## 登录功能
- URI：`/usr/login`
- 功能：处理一个账户登录请求
- 是否收到保护：否
- 接收参数：请求体内的 json 对象
- 请求方法：POST
- 请求体的 mime-type: `application/json`
```json
{
	"id": 123,            // 非必须
	"email": "string",    // 非必须
	"phone": "string",    // 非必须，但和上面的必须三选一
	"passwd": "string",   // 必须
}
```

> [!info]
> `id`, `email` `phone`  字段三选一，同样需要校验，格式同上

|     条件      | 响应码 | 表头内容 |  报文内容   |
| :---------: | :-: | :--: | :-----: |
|    成功登录     | 200 |      | jwt 字符串 |
|   密码账号不匹配   | 401 |      |         |
|     无账号     | 401 |      |         |


## 注销功能
- URI：`/usr`
- 功能：处理一个账户注销请求
- 是否收到保护：是，需要一个使用 `Bearer token` 承载的 jwt
- 接收参数：请求体内的密码字符串
- 请求方法：POST
- 请求体的 mime-type: `text/plain`
- 响应内容

|   条件    | 响应码 | 表头内容 | 报文内容 |
| :-----: | :-: | :--: | :--: |
|  成功删除   | 200 |      |      |
| 密码账号不匹配 | 401 |      |      |
|   无账号   | 401 |      |      |

## 查看账户信息
### 查看自己的信息
- URI：`/usr/bio`
- 功能：查看自己的信息
- 是否收到保护：是，同样需要一个 jwt （你必须先登录，服务器才知道你是谁）
- 接收参数：无
- 请求方法：GET，
- 请求体：空
- 响应内容

|         条件          | 响应码 | 表头内容 |    报文内容     |
| :-----------------: | :-: | :--: | :---------: |
|      成功查询到相应信息      | 200 |      |     如下      |
|     token 未通过校验     | 401 |      | 非结构化数据，之后再改 |
| 无账号（token 中的账户已经删除） | 404 |      |             |
```json
{
  "usr_id": 8,                                      // 用户 id
  "biography": "# 默认用户说明（开发中）",             // 用户自我介绍文件的路径
  "avatar": "默认头像图片路径（开发中）",               // 用户头像的请求路径
  "background": "默认背景图片路径（开发中）",           // 用户背景图片的请求路径
  "contact_me": [],                                 // 用户的联系方式
  "updated_at": "2025-08-12T14:30:52.437721+08:00"  // 用户上一次修改以上内容的时间
}
```
### 查看别人的信息
- URI：`/usr/{id}`，id 为想要查看的用户的 id
- 功能：查看其他人的信息
- 是否受保护：否，只是看一下不需要登录
- 接收参数：id，放在请求路径中
- 请求方法：GET
- 请求体：空
- 响应内容，同上

## JWT 内容
### 头部

```json
{
  "typ": "JWT",
  "alg": "HS256"
}
```

此处选用 `HS256` 算法
### 负载

```json
{
  "id": 2,
  "name": "Sylvan Lyon",
  "email": "sylvanlyon@gmail.com",
  "phone": null,
  "exp": 1754696343
}
```

返回字段包含 `id`、`name`、`email`、`phone` 和 `exp`。其中  `exp` 为 `token` 过期时间，目前默认是 12 小时后，默认拥有 60 秒的宽限期